#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

if [ $# -ne 4 ] ; then
    printf "Usage: copyRenamePython from_lower FromUpper to_lower ToUpper\n" 1>&2
    exit 1
fi

from_lower="$1"
from_upper="$2"
to_lower="$3"
to_upper="$4"

# Iterate over all files whose name or any of their parent directory's
# names contain $from_lower
while read path; do
    from_path="$path"

    # Replace all occurrences of $from_lower anywhere in path to file
    to_path=$(echo "$path" | sed "s/$from_lower/$to_lower/g")

    # Make all parent directories
    mkdir -p "$(dirname "$to_path")"

    # Replace all lower or uppercase occurrences in the file and write to
    # $to_path
    cat "$from_path" \
        | sed "s/$from_lower/$to_lower/g" \
        | sed "s/$from_upper/$to_upper/g" \
        > "$to_path"

done < <(fd --full-path --type file "$from_lower")

# Open editor to deal with other files in which the term appears
vim $(rg -l "$from_lower|$from_upper" | rg -v "$from_lower")
