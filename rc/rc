export LD_LIBRARY_PATH=/usr/local/lib
ulimit -c unlimited

export PATH=$PATH:/usr/local/texlive/2011/bin/x86_64-linux:~/bin:/usr/local/ssl/bin:~/bin:~/packer
export PATH=$PATH:/Library/TeX/Root/bin/x86_64-darwin
export PATH=$PATH:$HOME/bin
export PATH=$PATH:/usr/local/sbin
export MANPATH=$MANPATH:/usr/local/texlive/2011/texmf/doc/man
export INFOPATH=$INFOPATH:/usr/local/texlive/2011/texmf/doc/info

export VISUAL=nvim
export EDITOR=nvim
export VIMPAGER_VIM=nvim
export PAGER=$HOME/.config/nvim/plugged/vimpager/vimpager
export VIMPAGER_RC=$HOME/.vimpagerrc

[ -d $HOME/.custom.rc ] && source $HOME/.custom.rc

stty ixany
stty ixoff -ixon
stty stop undef
stty start undef

# No ttyctl, so we need to save and then restore terminal settings
vim()
{
    local STTYOPTS="$(stty -g)"
    stty stop '' -ixoff
    command nvim "$@"
    stty "$STTYOPTS"
}

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"  # This loads nvm

# some more ls aliases
alias   ll='ls -alF'
alias   la='ls -A'
alias    l='ls -CF'
alias    h='ls'
alias   gs='git status'
alias   gd='zoom-run git diff'
alias   gp='git push origin HEAD'
alias  gpf='git push --force origin HEAD'
alias  gpl='git pull'
alias   ga='git add'
alias  gcm='git commit --amend'
alias gcam='git commit -a --amend'
alias   gm='git merge'
alias   gA='git add -A'
alias   hs='sudo salt-call --local state.highstate'
alias   vu='vim +PlugUpgrade +PlugUpdate +PlugClean +qall'
alias    k='cd ..'
alias    c='cd'
alias   vm='ssh vm'
alias   tl='zoom-run tldr'
alias   pr='git pull-request -b develop'
alias   sz='source ~/.zshrc'
alias  pie='pip install -e .'
alias  fff='git flow feature finish'
alias  ffp='git flow feature publish'
# From http://macsimplelife.blogspot.com/2007/11/mac-os-x-hibernate-issue.html
alias  hon='sudo pmset -a hibernatemode 25'
alias hoff='sudo pmset -a hibernatemode 3'
alias  ccp='cookiecutter https://github.com/audreyr/cookiecutter-pypackage.git'
alias   pg='pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start'
alias pysu='pyenv shell --unset'
alias   sp='python -c "import site; print(site.getsitepackages()[0])"'

# Run man zoomed if in a tmux pane
alias man='zoom-run man'

# Add an "alert" alias for long running commands.  Use like so:
#   sleep 10; alert
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# For now only use vimpager on os x
if test "$(uname)" = "Darwin"; then
   alias vc='vimcat'
   export PAGER=vimpager
   alias ll='ls++ -A'

   PATH="$HOME/perl5/bin${PATH+:}${PATH}"; export PATH;
   PERL5LIB="$HOME/perl5/lib/perl5${PERL5LIB+:}${PERL5LIB}"; export PERL5LIB;
   PERL_LOCAL_LIB_ROOT="$HOME/perl5${PERL_LOCAL_LIB_ROOT+:}${PERL_LOCAL_LIB_ROOT}"; export PERL_LOCAL_LIB_ROOT;
   PERL_MB_OPT="--install_base \"$HOME/perl5\""; export PERL_MB_OPT;
   PERL_MM_OPT="INSTALL_BASE=$HOME/perl5"; export PERL_MM_OPT;
   export JAVA_HOME=$(/usr/libexec/java_home)
fi

fasd_cache="$HOME/.fasd-init-bash"
if [ "$(command -v fasd)" -nt "$fasd_cache" -o ! -s "$fasd_cache" ]; then
   fasd --init auto >| "$fasd_cache"
fi
source "$fasd_cache"
unset fasd_cache

# fzf
export FZF_DEFAULT_COMMAND='ag -l --hidden --ignore .git'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_DEFAULT_OPTS="--exact"

j() {
   local dir
   dir="$(fasd -Rdl "$1" | fzf-tmux -1 -0 --no-sort +m)" && cd "${dir}" || return 1
}

v() {
  local file
  file="$(fasd -Rfl "$1" | fzf-tmux -1 -0 --no-sort +m)" && vim "${file}" || return 1
}

# go - checkout git branch
go() {
  local branches branch
  branches=$(git branch -vv --color)
  branch=$(echo "$branches" | fzf-tmux --ansi -n 1 +m -0 -1 -q "$1")
  if test "$?" = "0"; then
    git checkout $(echo "$branch" | awk '{print $1}' | sed "s/.* //")
  fi
}

# list git branches
gb() {
  local branches branch out key
  branches=$(git branch -vv --color)
  out=$(echo "$branches" | fzf-tmux --ansi -n 1 +m -0 -q "$1" --expect=ctrl-d)
  if test "$?" = "0"; then
    key=$(head -1 <<< "$out")
    branch=$(head -2 <<< "$out" | tail -1 | awk '{print $1}' | sed "s/.* //")
    case "$key" in
       ctrl-d) git branch -d $branch ;;
            *) git checkout $branch ;;
    esac
  fi
}

# git commit browser
gl() {
  git log --graph --color=always \
      --format="%C(auto)%h%d %s %C(black)%C(bold)%cr" "$@" |
  fzf-tmux --ansi --no-sort --reverse --tiebreak=index --toggle-sort=\` \
      --bind "ctrl-m:execute:
                echo '{}' | grep -o '[a-f0-9]\{7\}' | head -1 |
                xargs -I % sh -c 'git show --color=always % | less -R'"
}

mc() {
   mkdir $1
   cd $1
}

eval "$(hub alias -s)"

export WORKON_HOME=~/.virtualenvs
source /usr/local/bin/virtualenvwrapper.sh

if which pyenv > /dev/null; then eval "$(pyenv init -)"; fi
if which pyenv-virtualenv-init > /dev/null; then eval "$(pyenv virtualenv-init -)"; fi

# http://marianposaceanu.com/articles/macos-sierra-upgrade-from-a-developers-perspective
# https://discussions.apple.com/thread/7682417?start=0&tstart=0
# https://www.reddit.com/r/MacOS/comments/4vro9d/macos_sierra_key_repeat/
if test "$(uname)" = "Darwin"; then
   defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false
   defaults write NSGlobalDomain KeyRepeat -int 1
   defaults write NSGlobalDomain InitialKeyRepeat -int 20
fi

eval $(thefuck --alias)
alias fu='fuck'
