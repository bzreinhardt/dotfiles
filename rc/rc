# Make shared libs work
export LD_LIBRARY_PATH=/usr/local/lib

# Core dumps
ulimit -c unlimited

# Setup PATH
export PATH=$PATH:/usr/local/texlive/2011/bin/x86_64-linux:~/bin:/usr/local/ssl/bin:~/bin:~/packer
export PATH=$PATH:/Library/TeX/Root/bin/x86_64-darwin
export PATH=$HOME/bin:/usr/local/bin:$PATH
export PATH=$PATH:/usr/local/sbin
export MANPATH=$MANPATH:/usr/local/texlive/2011/texmf/doc/man
export INFOPATH=$INFOPATH:/usr/local/texlive/2011/texmf/doc/info

# Other envvars
export VISUAL=nvim
export EDITOR=nvim
export VIMPAGER_VIM=nvim
export PAGER=$HOME/.config/nvim/plugged/vimpager/vimpager
export VIMPAGER_RC=$HOME/.vimpagerrc
export CTAGS_FLAGS="--tag-relative=yes --fields=+l --extras=+q"

[ -d $HOME/.custom.rc ] && source $HOME/.custom.rc

# Make vim tty stuff behave nicely
stty ixany
stty ixoff -ixon
stty stop undef
stty start undef
vim()
{
    # No ttyctl, so we need to save and then restore terminal settings
    local STTYOPTS="$(stty -g)"
    stty stop '' -ixoff
    command nvim "$@"
    stty "$STTYOPTS"
}

# Init nvm
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

source "$HOME/.sh/aliases.sh"

# For now only use vimpager on os x
if test "$(uname)" = "Darwin"; then
   alias vc='vimcat'
   export PAGER=vimpager
   alias ll='ls++ -A'

   # ls++
   PATH="$HOME/perl5/bin${PATH+:}${PATH}"; export PATH;
   PERL5LIB="$HOME/perl5/lib/perl5${PERL5LIB+:}${PERL5LIB}"; export PERL5LIB;
   PERL_LOCAL_LIB_ROOT="$HOME/perl5${PERL_LOCAL_LIB_ROOT+:}${PERL_LOCAL_LIB_ROOT}"; export PERL_LOCAL_LIB_ROOT;
   PERL_MB_OPT="--install_base \"$HOME/perl5\""; export PERL_MB_OPT;
   PERL_MM_OPT="INSTALL_BASE=$HOME/perl5"; export PERL_MM_OPT;
fi

[ -f /usr/libexec/java_home ] && export JAVA_HOME=$(/usr/libexec/java_home)

# fasd
fasd_cache="$HOME/.fasd-init-bash"
if [ "$(command -v fasd)" -nt "$fasd_cache" -o ! -s "$fasd_cache" ]; then
   fasd --init auto >| "$fasd_cache"
fi
source "$fasd_cache"
unset fasd_cache

# fzf
export FZF_DEFAULT_COMMAND='ag -l --hidden --ignore .git'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_DEFAULT_OPTS="--exact"

source "$HOME/.sh/commands.sh"

# Init hub
eval "$(hub alias -s)"

# Init pyenv
if which pyenv > /dev/null; then eval "$(pyenv init -)"; fi
if which pyenv-virtualenv-init > /dev/null; then eval "$(pyenv virtualenv-init -)"; fi

# http://marianposaceanu.com/articles/macos-sierra-upgrade-from-a-developers-perspective
# https://discussions.apple.com/thread/7682417?start=0&tstart=0
# https://www.reddit.com/r/MacOS/comments/4vro9d/macos_sierra_key_repeat/
if test "$(uname)" = "Darwin"; then
   defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false
   defaults write NSGlobalDomain KeyRepeat -int 1
   defaults write NSGlobalDomain InitialKeyRepeat -int 20
fi

# Init thefuck
eval $(thefuck --alias)
alias fu='fuck'
